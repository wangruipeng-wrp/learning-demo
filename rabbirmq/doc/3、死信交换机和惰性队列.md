# 死信交换机概述

什么是死信？ 当一个队列中的消息满足下列情况之一时，可以成为死信（dead letter）：

- 消费者使用basic.reject或 basic.nack声明消费失败，并且消息的requeue参数设置为false
- 消息是一个过期消息，超时无人消费
- 要投递的队列消息满了，无法投递

如果这个包含死信的队列配置了`dead-letter-exchange`属性，指定了一个交换机，那么队列中的死信就会投递到这个交换机中，而这个交换机称为**死信交换机**（Dead Letter Exchange，简称DLX）。

消息投递到死信队列的流程：

1. 一个正常的消息满足以上三种情况之一成为死信消息。
2. 该死信消息所在的队列绑定了死信交换机，如果未绑定，那么会直接丢弃死信消息。
3. 队列将死信消息投递到死信交换机，死信交换机再将该死信消息投递给对应的队列。

另外，队列将死信投递给死信交换机时，必须知道两个信息：

- 死信交换机名称
- 死信交换机与死信队列绑定的RoutingKey

这样才能确保投递的消息能到达死信交换机，并且正确的路由到死信队列。

死信交换机的使用场景：

1. 可以利用死信交换机收集所有消费者处理失败的消息（死信），交由人工处理，进一步提高消息队列的可靠性。为没成功处理的消息做一个兜底的操作
2. 搭配延时队列可以做一些延时处理的工作。具体的延迟处理方式见 `cool.wrp.rabbirmq.ttl` 包下内容。